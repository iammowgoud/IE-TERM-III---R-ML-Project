---
title: "EDA"
output:
  html_document:
    df_print: paged
---

```{r setup, echo=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = TRUE)

load_reqs <- function(reqs) {
  for(pkg in reqs) {
    if (!(pkg %in% installed.packages())) { install.packages(pkg) }
    suppressPackageStartupMessages(library(pkg, character.only = T))
  }
}

# ADD LIBRARIES HERE
load_reqs(c("tidyr", "dplyr", "data.table", "purrr", "ggplot2", "corrplot", "gridExtra", "grid", "cowplot", "PerformanceAnalytics"))
```

```{r echo=FALSE, warning=FALSE}
########################################
### Loading Data
########################################

train <- read.csv('../data/house_price_train.csv')
test <- read.csv('../data/house_price_test.csv')
```

***

### Check for the structure of the dataset
```{r echo=TRUE, warning=FALSE}
glimpse(train)
glimpse(test)
```

```{r echo=FALSE, warning=FALSE}
########################################
### DATA CLEANING
########################################
D = c("Purchase", "User_ID", "Product_ID")

numeric_vars <- unlist(lapply(train, is.integer)) 

for (i in colnames(train[numeric_vars])){
  if((i %in% DONT_CHANGE_VARS )== FALSE) {
  train[[i]] = as.factor(train[[i]])
  }
}

numeric_vars <- unlist(lapply(test, is.integer)) 

for (i in colnames(test[numeric_vars])){
  if((i %in% DONT_CHANGE_VARS )== FALSE) {
  test[[i]] = as.factor(test[[i]])
  }
}
```

```{r echo=FALSE, warning=FALSE}
########################################
### VARIABLES METADATA
########################################
TARGET <- "price"
IGNORE <- c("id", "date")

CATEGORICAL <- unlist(lapply(train, is.factor)) 
NUMERIC <- unlist(lapply(train, is.numeric)) 

NUMERIC[IGNORE] <- FALSE
CATEGORICAL[IGNORE] <- FALSE
NUMERIC[TARGET] <- FALSE
CATEGORICAL[TARGET] <- FALSE
```



### Check if there are any missing values in training and test datasets

```{r echo=TRUE, warning=FALSE}
train_na_cols <- colnames(train)[colSums(is.na(train)) > 0]
test_na_cols <- colnames(test)[colSums(is.na(test)) > 0]

print("Train NAs:")
length(train_na_cols)
print("Test NAs:")
length(test_na_cols)
```

**No NAs found**

***

#### Histogram of numerical Features
```{r echo=FALSE, fig.height=6, warning=FALSE}
histograms = list()
for (i in colnames(train[NUMERIC])){
  histograms[[i]] <-
    ggplot(
      train[NUMERIC],
      aes_string(x=i)) +
      geom_histogram(bins = 40, fill="blue") +
      theme_classic()
}
plot_grid(plotlist = histograms, ncol = 3)
```

**Some skewed distributions**
**Skewed vairables can be a problem for linear regression**

***

#### Variable skewness sorted

```{r echo=TRUE, fig.height=5, warning=FALSE}
skewness <- melt(NUMERIC[NUMERIC==TRUE], value.name = "value")
skewness$var <- rownames(skewness)
                         
for (i in colnames(train[NUMERIC])){
  skewness[i,"value"] = skewness(train[i])
}

skewness <- skewness[order(skewness$value),]

ggplot(data=skewness, aes(y=value, x=reorder(var, value))) +
  geom_bar(stat = "identity", fill="blue") +
  theme_classic()+
  theme(axis.text.x = element_text(angle = 90))+
  ggtitle("Variables Skewness")
```

***

#### Distribution of Target variable

```{r echo=TRUE, warning=FALSE}
scaleFUN <- function(x) sprintf("%.0f", x)

ggplot(train) + 
  geom_density(aes(x=price), alpha = 0.7)+
  geom_histogram(aes(x=price), bins = 40, position="identity", fill="blue", alpha = 0.7) + 
  scale_x_continuous(labels=scaleFUN)+
  theme_classic()
summary(train$price)
```

***

#### Correlation between two numerical features

```{r echo=TRUE, warning=FALSE}

res <- cor(train[NUMERIC])
corrplot.mixed(
          res,
          upper="circle",
          lower="number",
          tl.col = "black",
          number.cex = .6,
          tl.cex=.6)
```

**There is a high correlation between some of the variables, this can be a problem with linear regression**

